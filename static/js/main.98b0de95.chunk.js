(this.webpackJsonpbiogroove=this.webpackJsonpbiogroove||[]).push([[0],{152:function(e,t,n){},154:function(e,t,n){},155:function(e,t,n){},158:function(e,t,n){"use strict";n.r(t);var c=n(1),i=n.n(c),a=n(38),r=n.n(a),o=(n(152),n(7)),s=n(2),d=n.n(s),l=n(9),u=n(5),b=(n(154),n(22)),p=n.n(b),j=n(39),h=n.n(j),f=n.p+"static/media/Spotify_Logo_RGB_Green.0c4ae91b.png",m=(n(155),n(4)),O=n(0),v=function(e){var t=Object(c.createRef)(),n=e.script.actions;return Object(c.useEffect)((function(){if(t.current){var e=10,c=30,i=30,a=60,r=800-a-c,o=400-e-i,s=m.f(t.current).attr("width",r+a+c).attr("height",o+e+i).append("g").attr("transform","translate("+a+","+e+")"),d=m.e().domain([0,100]).range([o,0]),l=m.e().domain([0,m.d(n,(function(e){return e.at}))]).nice().range([0,r]);s.append("g").attr("transform","translate(0,"+o+")").call(m.a(l).ticks(Math.min(l.domain()[1]/1e3,50)).tickFormat((function(e){return"".concat(e/1e3,"s")}))),s.append("g").call(m.b(d));var u=m.c().x((function(e){return l(e.at)})).y((function(e){return d(e.pos)}));s.append("path").datum(n).attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5).attr("d",u)}}),[n,t]),Object(O.jsx)("svg",{ref:t})};function x(e,t){var n=localStorage.getItem(e);return n?JSON.parse(n):t}var w=function(){var e,t,n,i,a,r,s,j,m,w=Object(c.useState)(x("params",{minDepth:100,maxDepth:5e3,speed:3e3,showStats:!1,program:void 0})),g=Object(u.a)(w,1)[0],y={automaticSilentRenew:!0,authority:"https://accounts.spotify.com/authorize",metadata:{issuer:"https://accounts.spotify.com/authorize",authorization_endpoint:"https://accounts.spotify.com/authorize",token_endpoint:"https://accounts.spotify.com/api/token"},client_id:"5cb73d286b4848c4a53a7b5077ae3cf4",redirect_uri:window.location.protocol+"//"+window.location.host+window.location.pathname,post_logout_redirect_uri:window.location.protocol+"//"+window.location.host+"/index",silent_redirect_uri:window.location.protocol+"//"+window.location.host+"/index",response_type:"code",scope:"user-read-playback-state",loadUserInfo:!0,userStore:new p.a.WebStorageStateStore({store:window.localStorage})},k=Object(c.useState)(new b.UserManager(y)),S=Object(u.a)(k,1)[0],_=Object(c.useState)(new h.a),A=Object(u.a)(_,1)[0],T=Object(c.useState)(void 0),M=Object(u.a)(T,2),C=M[0],E=M[1],F=Object(c.useState)(void 0),U=Object(u.a)(F,2),L=U[0],R=U[1],J=Object(c.useState)(void 0),N=Object(u.a)(J,2),I=N[0],z=N[1],P=Object(c.useState)(void 0),B=Object(u.a)(P,2),D=B[0],G=B[1];function H(){return(H=Object(l.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(window.location.href.indexOf("code=")>0)){e.next=4;break}return e.next=3,S.signinRedirectCallback(window.location.href);case 3:window.location.href=window.location.origin+window.location.pathname;case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(){return(W=Object(l.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.getUser();case 2:if(t=e.sent,console.log(),null!==t){e.next=9;break}return e.next=7,S.signinRedirect();case 7:e.next=12;break;case 9:console.log(t),A.setAccessToken(t.access_token),E({access_token:t.access_token});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(){return(q=Object(l.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.getUser();case 2:if(null===e.sent){e.next=7;break}return e.next=6,S.removeUser();case 6:window.location.reload();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(){return(K=Object(l.a)(d.a.mark((function e(){var t,n,c,i,a,r,o,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="track-".concat(L.item.id),!(n=x(t,void 0))){e.next=6;break}c=n,e.next=10;break;case 6:return e.next=8,A.getAudioAnalysisForTrack(L.item.id);case 8:c=e.sent,localStorage.setItem(t,JSON.stringify(c));case 10:if(console.info("RESULT:",c),i=V(c),a="track-features--".concat(L.item.id),!(r=x(a,void 0))){e.next=19;break}o=r,e.next=23;break;case 19:return e.next=21,A.getAudioFeaturesForTrack(L.item.id);case 21:o=e.sent,localStorage.setItem(a,JSON.stringify(o));case 23:z([o,i]),s=i.sections.flatMap((function(e){return e.bars.flatMap((function(e){return e.beats.map((function(e,t){return{at:Q(e.start),pos:t%2===0?90:0}}))}))})),G({actions:s,inverted:!1,range:90,version:"1.0"}),console.info("mapped result: ",i);case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){return Math.ceil(1e3*e)}function V(e){function t(e,t){return t.start>=e.start&&t.start+t.duration<=e.start+e.duration}return Object(o.a)(Object(o.a)({},e),{},{sections:e.sections.map((function(n){return Object(o.a)(Object(o.a)({},n),{},{bars:e.bars.filter((function(e){return t(n,e)})).map((function(n){return Object(o.a)(Object(o.a)({},n),{},{beats:e.beats.filter((function(e){return t(n,e)}))})}))})}))})}Object(c.useEffect)((function(){sessionStorage.setItem("params",JSON.stringify(g))}),[g]),Object(c.useEffect)((function(){function e(){return(e=Object(l.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null===C||void 0===C?void 0:C.access_token)){e.next=11;break}return e.prev=1,e.next=4,A.getMyCurrentPlayingTrack();case 4:t=e.sent,R(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("failed to fetch current track",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[A,S,C]),function(){H.apply(this,arguments)}();var X=Object(c.useCallback)((function(){var e,t,n=JSON.stringify(D,["version","inverted","range","actions","pos","at"],2),c=new Blob([n],{type:"application/json"}),i=URL.createObjectURL(c),a=document.createElement("a");a.href=i,a.download="".concat(null===L||void 0===L||null===(e=L.item)||void 0===e?void 0:e.artists[0].name," - ").concat(null===L||void 0===L||null===(t=L.item)||void 0===t?void 0:t.name,".json"),document.body.appendChild(a),a.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),document.body.removeChild(a)}),[D,L]);function Y(e){return"".concat(Math.round(100*e),"%")}return Object(O.jsxs)("div",{className:"App",children:[Object(O.jsxs)("header",{className:"App-header",children:[!(null===C||void 0===C?void 0:C.access_token)&&Object(O.jsxs)("div",{children:[Object(O.jsx)("p",{children:"This tool can create FunScript files for the music you are playing on spotify. FunScripts are instructions for haptic human interaction feedback devices."}),Object(O.jsxs)("p",{children:["FunScripts can be played back with the ",Object(O.jsx)("a",{href:"https://github.com/FredTungsten/ScriptPlayer",children:"ScriptPlayer"})," or"]}),Object(O.jsxs)("p",{children:["Hit ",Object(O.jsx)("code",{children:"Login with Spotify"})," to get started."]}),Object(O.jsx)("button",{onClick:function(){return W.apply(this,arguments)},children:"Login with Spotify"})]}),!L&&Object(O.jsx)("div",{children:Object(O.jsx)("p",{children:"Time to choose a song! Use a Spotify device of your choice and start playback. Then reload this page."})}),L&&Object(O.jsxs)("div",{children:["Playing now:",(null===(e=L.item)||void 0===e?void 0:e.album.images[0])&&Object(O.jsxs)("div",{children:[Object(O.jsx)("br",{}),Object(O.jsx)("img",{alt:"Album cover",src:null===(t=L.item)||void 0===t?void 0:t.album.images[0].url,width:null===(n=L.item)||void 0===n?void 0:n.album.images[0].width,height:null===(i=L.item)||void 0===i?void 0:i.album.images[0].height})]}),Object(O.jsx)("br",{}),Object(O.jsx)("strong",{children:null===(a=L.item)||void 0===a?void 0:a.name}),Object(O.jsx)("br",{}),"by: ",null===(r=L.item)||void 0===r||null===(s=r.artists[0])||void 0===s?void 0:s.name,Object(O.jsx)("br",{}),"Album: ",null===(j=L.item)||void 0===j||null===(m=j.album)||void 0===m?void 0:m.name,Object(O.jsx)("br",{}),Object(O.jsx)("button",{onClick:function(){return K.apply(this,arguments)},children:"Analyze"})]}),I&&Object(O.jsx)("div",{children:Object(O.jsxs)("dl",{children:[Object(O.jsx)("dt",{children:"Dancability: "}),Object(O.jsx)("dd",{children:Y(I[0].danceability)}),Object(O.jsx)("dt",{children:"Acousticness: "}),Object(O.jsx)("dd",{children:Y(I[0].acousticness)}),Object(O.jsx)("dt",{children:"Energy: "}),Object(O.jsx)("dd",{children:Y(I[0].energy)}),Object(O.jsx)("dt",{children:"Liveness: "}),Object(O.jsx)("dd",{children:Y(I[0].liveness)}),Object(O.jsx)("dt",{children:"Tempo: "}),Object(O.jsxs)("dd",{children:[I[0].tempo," BPM"]})]})}),D&&Object(O.jsxs)("div",{children:[Object(O.jsx)(v,{script:D}),Object(O.jsx)("br",{}),Object(O.jsx)("button",{onClick:X,children:"Download Funscript"})]})]}),Object(O.jsxs)("p",{children:["This app is powered by",Object(O.jsx)("br",{}),Object(O.jsx)("img",{width:128,src:f,alt:"Spotify"}),"  Audio Analysis"]}),(null===C||void 0===C?void 0:C.access_token)&&Object(O.jsx)("p",{children:Object(O.jsx)("button",{onClick:function(){return q.apply(this,arguments)},children:"Logout"})})]})};n(157);r.a.render(Object(O.jsx)(i.a.StrictMode,{children:Object(O.jsx)(w,{})}),document.getElementById("root"))}},[[158,1,2]]]);
//# sourceMappingURL=main.98b0de95.chunk.js.map